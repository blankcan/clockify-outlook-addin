/*! For license information please see 2dcca6ee3ee946fef81d.js.LICENSE.txt */
function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var s=r&&r.prototype instanceof c?r:c,f=Object.create(s.prototype);return _regeneratorDefine2(f,"_invoke",function(n,r,o){var i,c,s,f=0,u=o||[],l=!1,g={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,c=0,s=e,g.n=n,a}};function d(n,r){for(c=n,s=r,t=0;!l&&f&&!o&&t<u.length;t++){var o,i=u[t],d=g.p,y=i[2];n>3?(o=y===r)&&(s=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(c=0,g.v=r,g.n=i[1]):d<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,g.n=y,c=0))}if(o||n>1)return a;throw l=!0,r}return function(o,u,y){if(f>1)throw TypeError("Generator is already running");for(l&&1===u&&d(u,y),c=u,s=y;(t=c<2?e:s)||!l;){i||(c?c<3?(c>1&&(g.n=-1),d(c,s)):g.n=s:g.v=s);try{if(f=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(l=g.n<0)?s:n.call(r,g))!==a)break}catch(t){i=e,c=1,s=t}finally{f=1}}return{value:t,done:l}}}(n,o,i),!0),f}var a={};function c(){}function s(){}function f(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),l=f.prototype=c.prototype=Object.create(u);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(l),e}return s.prototype=f,_regeneratorDefine2(l,"constructor",f),_regeneratorDefine2(f,"constructor",s),s.displayName="GeneratorFunction",_regeneratorDefine2(f,o,"GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,o,"Generator"),_regeneratorDefine2(l,r,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:i,m:g}})()}function _regeneratorDefine2(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var i=function(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){asyncGeneratorStep(i,r,o,a,c,"next",e)}function c(e){asyncGeneratorStep(i,r,o,a,c,"throw",e)}a(void 0)})}}import parseDuration from"parse-duration";import URI from"urijs";import{getConfig,setConfig}from"../helpers/addin-config";import{createTimeEntry}from"../helpers/clockify-api.js";!function(){"use strict";Office.onReady(function(e){$(function(){var n=document.getElementById("subject");if(document.getElementById("duration"),e.host===Office.HostType.Outlook){var o=Office.context.mailbox.item.subject||"No subject";n.value=o}$("#submitBtn").on("click",t),$("#settingsBtn").on("click",r),$(".quick-btn").on("click",function(e){var t=$(e.target).data("duration");$("#duration").val(t)})});var t=function(){i();var e=$("#duration").val().trim(),t=getConfig();if(console.log("config",t),!t.clockifyApiKey)return o("No Clockify API key found. Please configure it in Settings. Please configure your Clockify API key in Settings."),void r();if(e){var c=parseDuration(e);if(!c||c<=0)o("Invalid duration format.");else{var s=$("#subject").val().trim(),f=Math.floor(c/1e3);a("Submitting time entry for ".concat(f," seconds...")),f<1?o("Duration must be at least 1 second."):function(e,t){n.apply(this,arguments)}(c,s)}}else o("Please enter a duration.")};function n(){return(n=_asyncToGenerator(_regenerator().m(function e(t,n){var r,i,c,s,f,u,l,g;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(r=getConfig(),i=r.clockifyApiKey,c=r.clockifyWorkspaceId,s=r.clockifyProjectId,i&&c){e.n=1;break}return alert("Please configure your Clockify settings first."),openSettingsDialog(),e.a(2);case 1:if(t){e.n=2;break}return alert("Invalid duration format."),e.a(2);case 2:return f=new Date,u=f.toISOString(),l=new Date(f.getTime()-t).toISOString(),e.p=3,e.n=4,createTimeEntry({apiKey:i,workspaceId:c,projectId:s,description:n,startTime:l,endTime:u});case 4:a("Time entry created in Clockify!"),e.n=6;break;case 5:e.p=5,g=e.v,console.error(g),o("Failed to create time entry: ".concat(g.message));case 6:return e.a(2)}},e,null,[[3,5]])}))).apply(this,arguments)}var r=function(){var e=new URI("settingsDialog.html").absoluteTo(window.location).toString();console.log("Opening settings dialog at URL:",e),Office.context.ui.displayDialogAsync(e,{width:40,height:40,displayInIframe:!0},function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var t=e.value;t.addEventHandler(Office.EventType.DialogMessageReceived,function(e){console.log("Raw message:",e.message);var n=JSON.parse(e.message);setConfig(n,function(e){e.status===Office.AsyncResultStatus.Succeeded?(c(),a("Settings saved successfully."),t.close()):(console.error("Failed to save settings:",e.error.message),o("Failed to save settings: "+e.error.message))})}),t.addEventHandler(Office.EventType.DialogEventReceived,function(e){console.log("Dialog closed:",e)})}else console.error("Could not open settings dialog:",e.error.message)})},o=function(e){$("#error-message-container").removeClass("hide"),$("#errorMessage").text(e)},i=function(){$("#error-message-container").addClass("hide"),$("#errorMessage").text("")},a=function(e){$("#info-message-container").removeClass("hide"),$("#infoMessage").text(e)},c=function(){$("#info-message-container").addClass("hide"),$("#infoMessage").text("")}})}();